<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactica - Ideas Board</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hepta+Slab:wght@1..900&family=Rokkitt:ital,wght@0,100..900;1,100..900&display=swap');
        @import url('https://db.onlinewebfonts.com/c/23255fa3ff7a89589800cea3092f154f?family=NB+International+Regular+Webfont');

        body {
            background: black;
            color: rgb(255, 255, 255);
            font-family: "NB International Regular Webfont";
            line-height: 1.6;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .sidebar {
            width: 100%;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }

        h1 {
            font-size: 1.8rem;
        }

        h2 {
            font-size: 1.2rem;
            color: #fff;
        }

        a {
            color: rgb(195, 122, 255);
            text-decoration: none;
        }

        a:hover {
            color: rgb(215, 166, 252);
            text-decoration: underline;
        }

        .idea-form,
        .idea-stream,
        .auth-form {
            margin-top: 20px;
        }

        textarea,
        input,
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            color: white;
            font-family: inherit;
        }

        button {
            background: rgb(195, 122, 255);
            color: black;
            cursor: pointer;
            width: auto;
        }

        button:hover {
            background: rgb(215, 166, 252);
        }

        .idea {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }

        .idea-meta {
            font-size: 0.9em;
            color: #888;
        }

        .idea-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .social-links a {
            margin-right: 10px;
        }

        .community-members {
            margin-top: 20px;
        }

        .member {
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #1a1a1a;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #3a3a3a;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #fff;
            text-decoration: none;
        }

        .reply {
            margin-left: 20px;
            padding: 10px;
            background: #2a2a2a;
            border-left: 2px solid rgb(195, 122, 255);
            margin-top: 10px;
        }

        .reply-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }

        .welcome-message {
            background: #1a1a1a;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .community-link {
                display: inline-block;
            }
        }
    </style>
</head>

<body>
    <div class="main-content">
        <a href="/index.html">[home]</a>
        <a href="/hq/g-hq.html">[galactica-hq]</a>
        <a href="/lab/g-lab.html">[galactica-lab]</a>

        <h1>galactica - ideas board.</h1>
        <div id="auth-status"></div>
        <button id="logout-button" style="display: none;">Logout</button>
        <button id="edit-profile-button" style="display: none;">Edit Profile</button>
        <button id="delete-account-button" style="display: none;">Delete Account</button>
        <a href="#" id="community-link" class="community-link" style="display: none;">Community Members</a>

        <div class="welcome-message" id="welcome-message" style="display: none;">
            <p>Welcome to Galactica Ideas Board! Please log in or sign up to participate.</p>
            <button id="show-login">Login</button>
            <button id="show-signup">Sign Up</button>
        </div>

        <div class="idea-form" id="idea-form" style="display: none;">
            <textarea id="idea-input" maxlength="280" placeholder="Share your idea (max 280 characters)"></textarea>
            <button id="submit-idea">Submit Idea</button>
        </div>

        <div class="idea-stream" id="idea-stream">
            <!-- Ideas will be dynamically inserted here -->
        </div>
    </div>

    <div class="sidebar">
        <h2 id="join-community-heading">Join the Community</h2>
        <div class="auth-form" id="auth-form">
            <div id="login-fields" style="display: none;">
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button id="login-button">Login</button>
            </div>
            <div id="signup-fields" style="display: none;">
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required>
                <input type="text" id="display-name" placeholder="Display Name" required>
                <input type="text" id="linkedin" placeholder="LinkedIn URL (optional)">
                <input type="text" id="github" placeholder="GitHub URL (optional)">
                <input type="text" id="portfolio" placeholder="Portfolio URL (optional)">
                <button id="signup-button">Sign Up</button>
            </div>
        </div>

        <h2>Community Members (<span id="member-count">0</span>)</h2>
        <div class="community-members" id="community-members">
            <!-- Members will be dynamically inserted here -->
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Profile</h2>
            <input type="text" id="edit-display-name" placeholder="Display Name">
            <input type="text" id="edit-linkedin" placeholder="LinkedIn URL">
            <input type="text" id="edit-github" placeholder="GitHub URL">
            <input type="text" id="edit-portfolio" placeholder="Portfolio URL (optional)">
            <button id="update-profile-button">Update Profile</button>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="delete-account-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Delete Account</h2>
            <p>Are you sure you want to delete your account? This action cannot be undone.</p>
            <button id="confirm-delete-account">Yes, Delete My Account</button>
            <button id="cancel-delete-account">Cancel</button>
        </div>
    </div>

    <!-- View Post Modal -->
    <div id="view-post-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="post-content"></div>
            <div id="post-replies"></div>
            <div id="reply-form">
                <textarea id="reply-input" placeholder="Your reply"></textarea>
                <button id="submit-reply">Submit Reply</button>
            </div>
        </div>
    </div>

    <!-- Edit Idea Modal -->
    <div id="edit-idea-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Idea</h2>
            <textarea id="edit-idea-input" maxlength="280"></textarea>
            <button id="update-idea-button">Update Idea</button>
        </div>
    </div>

    <!-- Auth Success Modal -->
    <div id="auth-success-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="auth-success-message"></h2>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCSY1onR4PO2nF4EtA9ZkHvJb8KHEI9M8g",
            authDomain: "galactica-f174c.firebaseapp.com",
            projectId: "galactica-f174c",
            storageBucket: "galactica-f174c.appspot.com",
            messagingSenderId: "152146817639",
            appId: "1:152146817639:web:45110faf6d2c3649c5dac2",
            measurementId: "G-T19QCVB3F1"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // DOM Elements
        const authStatus = document.getElementById('auth-status');
        const authForm = document.getElementById('auth-form');
        const ideaForm = document.getElementById('idea-form');
        const ideaInput = document.getElementById('idea-input');
        const submitIdeaButton = document.getElementById('submit-idea');
        const ideaStream = document.getElementById('idea-stream');
        const loginButton = document.getElementById('login-button');
        const signupButton = document.getElementById('signup-button');
        const logoutButton = document.getElementById('logout-button');
        const editProfileButton = document.getElementById('edit-profile-button');
        const deleteAccountButton = document.getElementById('delete-account-button');
        const editProfileModal = document.getElementById('edit-profile-modal');
        const deleteAccountModal = document.getElementById('delete-account-modal');
        const viewPostModal = document.getElementById('view-post-modal');
        const editIdeaModal = document.getElementById('edit-idea-modal');
        const authSuccessModal = document.getElementById('auth-success-modal');
        const updateProfileButton = document.getElementById('update-profile-button');
        const confirmDeleteAccountButton = document.getElementById('confirm-delete-account');
        const cancelDeleteAccountButton = document.getElementById('cancel-delete-account');
        const communityMembers = document.getElementById('community-members');
        const joinCommunityHeading = document.getElementById('join-community-heading');
        const communityLink = document.getElementById('community-link');
        const showLoginButton = document.getElementById('show-login');
        const showSignupButton = document.getElementById('show-signup');
        const loginFields = document.getElementById('login-fields');
        const signupFields = document.getElementById('signup-fields');
        const welcomeMessage = document.getElementById('welcome-message');
        const memberCount = document.getElementById('member-count');

        // Authentication state observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                authStatus.textContent = `Logged in as ${user.email}`;
                authForm.style.display = 'none';
                ideaForm.style.display = 'block';
                logoutButton.style.display = 'inline-block';
                editProfileButton.style.display = 'inline-block';
                deleteAccountButton.style.display = 'inline-block';
                communityLink.style.display = 'inline-block';
                joinCommunityHeading.style.display = 'none';
                welcomeMessage.style.display = 'none';
            } else {
                authStatus.textContent = '';
                authForm.style.display = 'block';
                ideaForm.style.display = 'none';
                logoutButton.style.display = 'none';
                editProfileButton.style.display = 'none';
                deleteAccountButton.style.display = 'none';
                communityLink.style.display = 'none';
                joinCommunityHeading.style.display = 'block';
                welcomeMessage.style.display = 'block';
            }
            updateMembersList();
            loadIdeas();
        });

        // Sign Up
        function signUp(email, password, displayName, linkedin, github, portfolio) {
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        displayName: displayName,
                        linkedin: linkedin,
                        github: github,
                        portfolio: portfolio,
                        email: email
                    });
                })
                .then(() => {
                    showAuthSuccessModal("Successfully signed up!");
                })
                .catch((error) => showErrorMessage(error.message));
        }

        // Login
        function login(email, password) {
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    showAuthSuccessModal("Successfully logged in!");
                })
                .catch((error) => showErrorMessage(error.message));
        }

        // Logout
        function logout() {
            auth.signOut()
                .then(() => console.log("Logged out"))
                .catch((error) => console.error(error));
        }

        // Load User Profile
      // Load User Profile
      function loadUserProfile(userId) {
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('edit-display-name').value = data.displayName || '';
                        document.getElementById('edit-linkedin').value = data.linkedin || '';
                        document.getElementById('edit-github').value = data.github || '';
                        document.getElementById('edit-portfolio').value = data.portfolio || '';
                    }
                })
                .catch((error) => console.error("Error loading user profile:", error));
        }

        // Update Profile
        function updateProfile(displayName, linkedin, github, portfolio) {
            const user = auth.currentUser;
            if (user) {
                db.collection('users').doc(user.uid).update({
                    displayName: displayName,
                    linkedin: linkedin,
                    github: github,
                    portfolio: portfolio
                })
                .then(() => {
                    showSuccessMessage("Profile updated successfully!", editProfileModal);
                })
                .catch((error) => showErrorMessage("Error updating profile: " + error.message));
            }
        }

        // Delete Account
        function deleteAccount() {
            const user = auth.currentUser;
            if (user) {
                db.collection('users').doc(user.uid).delete()
                    .then(() => user.delete())
                    .then(() => {
                        deleteAccountModal.style.display = 'none';
                        showAuthSuccessModal("Account deleted successfully!");
                    })
                    .catch((error) => console.error("Error deleting account:", error));
            }
        }

        // Submit Idea
        function submitIdea(ideaText) {
            const user = auth.currentUser;
            if (user && ideaText.trim() !== '' && ideaText.length <= 280) {
                db.collection('ideas').add({
                    text: ideaText.trim(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    authorId: user.uid
                })
                    .then(() => {
                        ideaInput.value = '';
                        loadIdeas();
                    })
                    .catch((error) => console.error("Error submitting idea:", error));
            }
        }

        // Create Idea Element
        function createIdeaElement(id, idea) {
            const ideaDiv = document.createElement('div');
            ideaDiv.className = 'idea';
            db.collection('users').doc(idea.authorId).get().then((doc) => {
                const userData = doc.exists ? doc.data() : { displayName: 'Anonymous' };
                ideaDiv.innerHTML = `
                    <div class="idea-meta">
                        > posted by ${userData.displayName} <${new Date(idea.timestamp.toDate()).toLocaleString()}>
                        <div class="social-links">
                            ${userData.linkedin ? `[<a href="${userData.linkedin}" target="_blank">linkedin</a>]` : ''}
                            ${userData.github ? `[<a href="${userData.github}" target="_blank">github</a>]` : ''}
                            ${userData.portfolio ? `[<a href="${userData.portfolio}" target="_blank">portfolio</a>]` : ''}
                        </div>
                    </div>
                    <p>${idea.text}</p>
                    <div class="idea-actions">
                        ${idea.authorId === auth.currentUser?.uid ? `
                            <button onclick="editIdea('${id}')">Edit</button>
                            <button onclick="deleteIdea('${id}')">Delete</button>
                        ` : ''}
                        <button class="reply-button" onclick="viewPost('${id}')">View Post</button>
                    </div>
                `;
            });
            return ideaDiv;
        }

        // Edit Idea
        function editIdea(id) {
            const ideaRef = db.collection('ideas').doc(id);
            ideaRef.get().then((doc) => {
                if (doc.exists && doc.data().authorId === auth.currentUser?.uid) {
                    const idea = doc.data();
                    document.getElementById('edit-idea-input').value = idea.text;
                    editIdeaModal.style.display = 'block';
                    document.getElementById('update-idea-button').onclick = () => {
                        const newText = document.getElementById('edit-idea-input').value;
                        if (newText.trim() !== '' && newText.length <= 280) {
                            ideaRef.update({ text: newText.trim() })
                                .then(() => {
                                    editIdeaModal.style.display = 'none';
                                    loadIdeas();
                                })
                                .catch((error) => console.error("Error updating idea:", error));
                        }
                    };
                }
            });
        }

        // Delete Idea
        function deleteIdea(id) {
            if (confirm("Are you sure you want to delete this idea?")) {
                db.collection('ideas').doc(id).delete()
                    .then(() => loadIdeas())
                    .catch((error) => console.error("Error deleting idea:", error));
            }
        }

        // View Post
        function viewPost(ideaId) {
            const postContent = document.getElementById('post-content');
            const postReplies = document.getElementById('post-replies');
            const replyForm = document.getElementById('reply-form');

            db.collection('ideas').doc(ideaId).get().then((doc) => {
                if (doc.exists) {
                    const idea = doc.data();
                    postContent.innerHTML = createIdeaElement(doc.id, idea).innerHTML;
                    loadReplies(ideaId);
                    viewPostModal.style.display = 'block';

                    document.getElementById('submit-reply').onclick = () => {
                        const replyText = document.getElementById('reply-input').value;
                        submitReply(ideaId, replyText);
                    };
                }
            });
        }

        // Submit Reply
        function submitReply(ideaId, replyText) {
            const user = auth.currentUser;
            if (user && replyText.trim() !== '') {
                db.collection('ideas').doc(ideaId).collection('replies').add({
                    text: replyText.trim(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    authorId: user.uid
                })
                    .then(() => {
                        document.getElementById('reply-input').value = '';
                        loadReplies(ideaId);
                    })
                    .catch((error) => console.error("Error submitting reply:", error));
            }
        }

        // Load Replies
        function loadReplies(ideaId) {
            const postReplies = document.getElementById('post-replies');
            postReplies.innerHTML = '';
            db.collection('ideas').doc(ideaId).collection('replies').orderBy('timestamp', 'asc').get()
                .then((snapshot) => {
                    snapshot.forEach((doc) => {
                        const reply = doc.data();
                        const replyElement = document.createElement('div');
                        replyElement.className = 'reply';
                        db.collection('users').doc(reply.authorId).get().then((userDoc) => {
                            const userData = userDoc.exists ? userDoc.data() : { displayName: 'Anonymous' };
                            replyElement.innerHTML = `
                                <p><strong>${userData.displayName}</strong>: ${reply.text}</p>
                                <small>${new Date(reply.timestamp.toDate()).toLocaleString()}</small>
                                ${reply.authorId === auth.currentUser?.uid ? `
                                    <button onclick="deleteReply('${ideaId}', '${doc.id}')">Delete</button>
                                ` : ''}
                            `;
                            postReplies.appendChild(replyElement);
                        });
                    });
                })
                .catch((error) => console.error("Error loading replies:", error));
        }

        // Delete Reply
        function deleteReply(ideaId, replyId) {
            if (confirm("Are you sure you want to delete this reply?")) {
                db.collection('ideas').doc(ideaId).collection('replies').doc(replyId).delete()
                    .then(() => loadReplies(ideaId))
                    .catch((error) => console.error("Error deleting reply:", error));
            }
        }

        // Update Members List
        function updateMembersList() {
            db.collection('users').get().then((snapshot) => {
                communityMembers.innerHTML = '';
                let count = 0;
                snapshot.forEach((doc) => {
                    const user = doc.data();
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'member';
                    memberDiv.innerHTML = `
                        ${user.displayName || 'Anonymous'}
                        ${user.linkedin ? `[<a href="${user.linkedin}" target="_blank">linkedin</a>]` : ''}
                        ${user.github ? `[<a href="${user.github}" target="_blank">github</a>]` : ''}
                        ${user.portfolio ? `[<a href="${user.portfolio}" target="_blank">portfolio</a>]` : ''}
                    `;
                    communityMembers.appendChild(memberDiv);
                    count++;
                });
                memberCount.textContent = count;
            }).catch((error) => console.error("Error updating members list:", error));
        }

        // Load Ideas
        function loadIdeas() {
            db.collection('ideas').orderBy('timestamp', 'desc').get().then((snapshot) => {
                ideaStream.innerHTML = '';
                snapshot.forEach((doc) => {
                    const idea = doc.data();
                    const ideaElement = createIdeaElement(doc.id, idea);
                    ideaStream.appendChild(ideaElement);
                });
            }).catch((error) => console.error("Error loading ideas:", error));
        }

        // Show Auth Success Modal
        function showAuthSuccessModal(message) {
            document.getElementById('auth-success-message').textContent = message;
            authSuccessModal.style.display = 'block';
        }

        // Show Error Message
        function showErrorMessage(message) {
            alert(message); // You can replace this with a more elegant solution if desired
        }

        // Show Success Message
        function showSuccessMessage(message, modalElement) {
            const successMessage = document.createElement('p');
            successMessage.textContent = message;
            successMessage.style.color = 'green';
            modalElement.querySelector('.modal-content').appendChild(successMessage);
            setTimeout(() => {
                successMessage.remove();
                modalElement.style.display = 'none';
            }, 2000);
        }

        // Event Listeners
        signupButton.addEventListener('click', () => {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const displayName = document.getElementById('display-name').value;
            const linkedin = document.getElementById('linkedin').value;
            const github = document.getElementById('github').value;
            const portfolio = document.getElementById('portfolio').value;
            signUp(email, password, displayName, linkedin, github, portfolio);
        });

        loginButton.addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            login(email, password);
        });

        logoutButton.addEventListener('click', logout);

        submitIdeaButton.addEventListener('click', () => submitIdea(ideaInput.value));

        editProfileButton.addEventListener('click', () => {
            editProfileModal.style.display = 'block';
            loadUserProfile(auth.currentUser.uid);
        });

        updateProfileButton.addEventListener('click', () => {
            const displayName = document.getElementById('edit-display-name').value;
            const linkedin = document.getElementById('edit-linkedin').value;
            const github = document.getElementById('edit-github').value;
            const portfolio = document.getElementById('edit-portfolio').value;
            updateProfile(displayName, linkedin, github, portfolio);
        });

        deleteAccountButton.addEventListener('click', () => {
            deleteAccountModal.style.display = 'block';
        });

        confirmDeleteAccountButton.addEventListener('click', deleteAccount);

        cancelDeleteAccountButton.addEventListener('click', () => {
            deleteAccountModal.style.display = 'none';
        });

        communityLink.addEventListener('click', () => {
            const sidebar = document.querySelector('.sidebar');
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        });

        showLoginButton.addEventListener('click', () => {
            loginFields.style.display = 'block';
            signupFields.style.display = 'none';
        });

        showSignupButton.addEventListener('click', () => {
            loginFields.style.display = 'none';
            signupFields.style.display = 'block';
        });

        // Close modals when clicking outside
        window.onclick = function (event) {
            if (event.target == editProfileModal) {
                editProfileModal.style.display = "none";
            }
            if (event.target == deleteAccountModal) {
                deleteAccountModal.style.display = "none";
            }
            if (event.target == authSuccessModal) {
                authSuccessModal.style.display = "none";
            }
            if (event.target == viewPostModal) {
                viewPostModal.style.display = "none";
            }
            if (event.target == editIdeaModal) {
                editIdeaModal.style.display = "none";
            }
        }

        // Close button functionality for modals
        document.querySelectorAll('.close').forEach(closeButton => {
            closeButton.onclick = function () {
                this.parentElement.parentElement.style.display = 'none';
            }
        });

        // Initialize
        updateMembersList();
        loadIdeas();
    </script>
</body>

</html>